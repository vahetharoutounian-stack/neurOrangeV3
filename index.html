<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>neurOrange ‚Äî Audio Dock (Storm-only Autoplay, Fixed)</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  :root{
    --bg:#0c0b0a;
    --text:#fff;
    --dock:#FF6600;     /* Nickelodeon */
    --bergamot:#FFA64D; /* Bergamot pulse */
    --jinn:#F88E10;     /* Jinn Flame for play/pause */
    --saffron:#F4C430;  /* Saffron for sprout buttons */
    --ring:rgba(0,0,0,.35);
    --shadow:0 8px 22px rgba(255,102,0,.35);
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:720px;margin:28px auto;padding:0 16px}
  h1{margin:8px 0 6px;font-size:36px;line-height:1.12;text-align:center}
  p.desc{opacity:.85;text-align:center;margin:0 0 18px}

  /* Hide any legacy compact player if present */
  #audioDock{ display:none !important; }

  /* === Audio Dock (bottom-left) === */
  #audioDock2{
    position:fixed;
    left:calc(8px + env(safe-area-inset-left));
    bottom:calc(8px + env(safe-area-inset-bottom));
    z-index:2147483647;
    display:flex;align-items:center;gap:10px;
    padding:10px 12px;border-radius:999px;
    background:var(--dock);border:1px solid var(--ring);box-shadow:var(--shadow);
    -webkit-user-select:none;user-select:none;transform:scale(.8);transform-origin:bottom left;
  }
  #audioDock2.collapsed .ad-wrap{ display:none; }
  #audioDock2.collapsed .ad-vol{ display:none!important; }

  .ad-toggle,.ad-play,.ad-btn{
    width:42px;height:42px;min-width:42px;border-radius:50%;
    display:inline-flex;align-items:center;justify-content:center;
    font-size:22px;line-height:1;border:0;cursor:pointer;
    box-shadow:0 2px 6px rgba(0,0,0,.25);
    transition:transform .06s ease, box-shadow .2s ease;
    color:#111;background:#fff;
  }
  .ad-toggle{ background:var(--bergamot); }
  .ad-toggle:active{ transform:translateY(1px); }
  .ad-play{ background:var(--jinn); }
  .ad-play:active{ transform:translateY(1px); }

  .ad-btn{ background:var(--saffron); }
  .ad-btn:active{ transform:translateY(1px); }
  .ad-btn.active{
    outline:2px solid rgba(255,255,255,.9);
    background:#fdfdfd;
    box-shadow:0 4px 14px rgba(0,0,0,.35), 0 0 0 2px #fff inset;
  }

  #audioDock2 .ad-wrap{ position:relative; }

  .ad-vol{
    position:absolute;bottom:58px;width:44px;padding:8px 6px;border-radius:12px;
    background:rgba(22,22,22,.92);border:1px solid rgba(255,255,255,.2);
    box-shadow:0 10px 24px rgba(0,0,0,.45);display:none;left:50%;transform:translateX(-50%);
  }
  .ad-vol.visible{ display:block; }
  .ad-vol label{
    display:block;text-align:center;margin-bottom:6px;color:#fff;font-size:11px;opacity:.85;
  }
  .ad-vol input[type="range"]{
    writing-mode:bt-lr;-webkit-appearance:slider-vertical;width:30px;height:110px;
    background:transparent;margin:0 auto;padding:0;
  }
  .ad-vol input[type="range"]::-webkit-slider-runnable-track{
    width:6px;height:110px;background:#ddd;border-radius:999px;border:0;margin-left:12px;
  }
  .ad-vol input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none;width:18px;height:18px;border-radius:50%;
    background:var(--dock);border:1px solid rgba(0,0,0,.35);box-shadow:0 1px 4px rgba(0,0,0,.35);
  }
  .ad-vol input[type="range"]::-moz-range-track{
    width:6px;height:110px;background:#ddd;border-radius:999px;border:0;
  }
  .ad-vol input[type="range"]::-moz-range-thumb{
    width:18px;height:18px;border-radius:50%;background:var(--dock);border:1px solid rgba(0,0,0,.35);
  }

  /* Pulse the toggle when expanded */
  @keyframes bergamotPulse{
    0%,100%{ box-shadow:0 0 0 6px rgba(255,166,77,.45), 0 8px 22px rgba(0,0,0,.35) }
    50%    { box-shadow:0 0 0 12px rgba(255,166,77,.12),0 8px 22px rgba(0,0,0,.35) }
  }
  #audioDock2:not(.collapsed) #adToggle{ animation:bergamotPulse 1.6s ease-in-out infinite; }
  @media (prefers-reduced-motion:reduce){ #audioDock2:not(.collapsed) #adToggle{ animation:none } }

  /* Demo header (keep or remove) */
  h2.title{font-weight:900;margin:0 0 8px;text-align:center}
  .panel{max-width:720px;margin:12px auto;padding:14px;border:1px solid rgba(255,255,255,.2);border-radius:12px;background:rgba(255,255,255,.04)}
</style>
</head>
<body>

<div class="wrap">
  <h1>neurOrange ‚Äî Audio Dock</h1>
  <p class="desc">Storm-only autoplay, working play/pause, sliders at 75% (iOS-safe). Replace this header with your content.</p>
</div>

<!-- ====== Audio Dock ====== -->
<div id="audioDock2" class="collapsed" role="group" aria-label="Audio Player">
  <button class="ad-toggle" id="adToggle" title="Expand/Collapse">üü†</button>
  <button class="ad-play"   id="adPlay"   title="Play/Pause">‚ñ∂</button>

  <!-- Sparkle -->
  <div class="ad-wrap">
    <button class="ad-btn" data-track="sparkle" title="Sparkle">üå±</button>
    <div class="ad-vol" data-for="sparkle"><label>‚ú®</label>
      <input type="range" min="0" max="1" step="0.01" value="0.75"></div>
  </div>

  <!-- Orange -->
  <div class="ad-wrap">
    <button class="ad-btn" data-track="orange" title="Orange">üå±</button>
    <div class="ad-vol" data-for="orange"><label>üçä</label>
      <input type="range" min="0" max="1" step="0.01" value="0.75"></div>
  </div>

  <!-- Autumn -->
  <div class="ad-wrap">
    <button class="ad-btn" data-track="autumn" title="Autumn">üå±</button>
    <div class="ad-vol" data-for="autumn"><label>üçÇ</label>
      <input type="range" min="0" max="1" step="0.01" value="0.75"></div>
  </div>

  <!-- Storm -->
  <div class="ad-wrap">
    <button class="ad-btn" data-track="storm" title="Storm">üå±</button>
    <div class="ad-vol" data-for="storm"><label>‚õàÔ∏è</label>
      <input type="range" min="0" max="1" step="0.01" value="0.75"></div>
  </div>

  <!-- Audio elements: keep in /tracks/ -->
  <audio id="aud_sparkle" preload="metadata" playsinline src="tracks/sparkle.mp3"></audio>
  <audio id="aud_orange"  preload="metadata" playsinline src="tracks/orange.mp3"></audio>
  <audio id="aud_autumn"  preload="metadata" playsinline src="tracks/autumn.mp3"></audio>
  <audio id="aud_storm"   preload="metadata" playsinline src="tracks/storm.mp3"></audio>
</div>

<!-- ====== Your main page content (optional demo) ====== -->
<div class="panel">
  <h2 class="title">Page Content</h2>
  <p>This is a minimal content panel. Replace with your Step 1/2/3 sections or gallery.</p>
</div>

<!-- ====== Audio Logic (fixed) ====== -->
<script>
(function(){
  // Track metadata (Storm ambient; others melodic/exclusive)
  const TRACKS = {
    sparkle:{ on:'‚ú®', el:'aud_sparkle', group:'melodic' },
    orange: { on:'üçä', el:'aud_orange',  group:'melodic' },
    autumn: { on:'üçÇ', el:'aud_autumn',  group:'melodic' },
    storm:  { on:'‚õàÔ∏è', el:'aud_storm',   group:'ambient' }
  };

  const DOCK   = document.getElementById('audioDock2');
  const TOGGLE = document.getElementById('adToggle');
  const PLAY   = document.getElementById('adPlay');
  const SEED   = 'üå±';
  const ACTIVE = new Set();
  let unlocked = false;

  const btn = n => DOCK.querySelector(`.ad-btn[data-track="${n}"]`);
  const vol = n => DOCK.querySelector(`.ad-vol[data-for="${n}"]`);
  const aud = n => document.getElementById(TRACKS[n].el);

  function anyPlaying(){
    for(const n of ACTIVE){ const a=aud(n); if(a && !a.paused) return true; }
    return false;
  }
  function setIcon(){ if(PLAY) PLAY.textContent = anyPlaying() ? '‚è∏' : '‚ñ∂'; }
  function center(v){ if(v){ v.style.left='50%'; v.style.transform='translateX(-50%)'; } }

  function deactivate(name){
    const a=aud(name), b=btn(name), v=vol(name);
    if(a){ try{ a.pause(); a.currentTime=0; }catch(_){} }
    ACTIVE.delete(name);
    if(b){ b.textContent=SEED; b.classList.remove('active'); }
    if(v){ v.classList.remove('visible'); }
  }
  function activate(name){
    const info=TRACKS[name]; if(!info) return;
    if(info.group==='melodic'){ [...ACTIVE].forEach(o=>{ if(TRACKS[o].group==='melodic' && o!==name) deactivate(o); }); }
    const a=aud(name), b=btn(name), v=vol(name);
    if(a){ a.loop=(name==='storm'); a.play().catch(()=>{}); }
    ACTIVE.add(name);
    if(b){ b.textContent=info.on; b.classList.add('active'); }
    if(v){ center(v); v.classList.add('visible'); }
  }
  function startStormOnly(){
    Object.keys(TRACKS).forEach(deactivate);
    activate('storm');
    setIcon();
  }

  // Volumes (default .75; persist)
  function initVolumes(){
    Object.keys(TRACKS).forEach(name=>{
      const a=aud(name), r=vol(name)?.querySelector('input[type="range"]'); if(!a||!r) return;
      const saved=localStorage.getItem('advol_'+name);
      const def=parseFloat(r.value||'0.75')||0.75;
      const v=saved!=null?parseFloat(saved):def;
      a.volume=v; r.value=String(v);
      const onChange=()=>{ const nv=Math.max(0,Math.min(1,parseFloat(r.value||'0'))); a.volume=nv; try{localStorage.setItem('advol_'+name,nv);}catch(_){} };
      r.addEventListener('input',onChange,{passive:true});
      r.addEventListener('change',onChange,{passive:true});
    });
  }

  // iOS-safe unlock: silently prime all, then Storm-only
  function unlock(){
    if(unlocked) return;
    Object.keys(TRACKS).forEach(name=>{
      const a=aud(name); if(!a) return;
      const prev=a.volume; a.muted=true;
      const p=a.play();
      (p&&p.then?p:Promise.resolve()).then(()=>{
        a.pause(); a.currentTime=0; a.muted=false; a.volume=prev;
      }).catch(()=>{ a.muted=false; a.volume=prev; });
    });
    setTimeout(startStormOnly, 0);
    unlocked=true;
    document.removeEventListener('pointerdown', unlock, true);
  }

  function bind(){
    // buttons
    DOCK.querySelectorAll('.ad-btn').forEach(b=>{
      b.addEventListener('click',()=>{ const n=b.getAttribute('data-track'); ACTIVE.has(n)?deactivate(n):activate(n); setIcon(); },{passive:true});
    });
    if(TOGGLE){
      TOGGLE.addEventListener('click',()=>{
        unlock();
        DOCK.classList.toggle('collapsed');
        if(!DOCK.classList.contains('collapsed')){
          ACTIVE.forEach(n=>{ const v=vol(n); center(v); if(v) v.classList.add('visible'); });
        }
      },{passive:true});
    }
    if(PLAY){
      PLAY.addEventListener('click',()=>{
        if(!unlocked){ unlock(); setIcon(); return; }
        if(anyPlaying()){
          ACTIVE.forEach(n=>{ const a=aud(n); if(a) try{a.pause();}catch(_){} });
        }else{
          if(ACTIVE.size) ACTIVE.forEach(n=>{ const a=aud(n); if(a) a.play().catch(()=>{}); });
          else startStormOnly();
        }
        setIcon();
      },{passive:true});
    }
    document.addEventListener('pointerdown', unlock, true);
  }

  initVolumes();
  bind();
  setIcon();
})();
</script>

</body>
</html>
